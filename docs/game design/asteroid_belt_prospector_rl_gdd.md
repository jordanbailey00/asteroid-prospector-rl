# Asteroid Belt Prospector — RL-Oriented Game Design Document

## 1) High-level concept

You pilot a small mining ship in a procedurally generated asteroid belt. Your job is to **discover** valuable rocks (under uncertainty), **extract** resources efficiently (under heat / wear constraints), **manage risk** (pirates, micro-impacts, catastrophic fractures), and **sell into a dynamic market** (prices move with time and your own supply).

This is intentionally designed to be a **long-horizon, non-linear, partially observable** decision problem where strong policies require:
- information gathering + belief management  
- route planning with constraints  
- risk-adjusted profit optimization  
- timing and market impact awareness  
- learning “hidden structure” of the belt + economy across many episodes

---

## 2) RL suitability requirements (explicit)

This environment is a strong RL candidate because it has:

### Non-linearity (not solvable by a simple rule)
- Mining yield is **stochastic** and depends on hidden asteroid properties.
- Overheating, tool wear, and hull damage create **threshold effects** (small mistakes can cascade into big losses).
- Market prices respond to supply/demand and to **your own sales volume** (selling too much of one ore crashes its price).

### Strategic depth that can be optimized over millions of steps
- Value comes from **policies**: scanning strategies, routing, inventory selection, risk posture, and timing.
- There are many locally good behaviors (greedy mining, always selling immediately) that are globally suboptimal.

### Partial observability + uncertainty
- Asteroid composition is not known without scanning.
- Pirate risk is observed only indirectly (signals, region history, time).
- “Rich” asteroids can be decoys, and scan readings are noisy.

### Long horizon credit assignment
- The best choice now might be to scan, travel, cool down, or avoid a region—actions that pay off much later.

---

## 3) World model

### Map / space representation
Choose one (both are RL-friendly):

**Option A — Continuous 2D sector**
- Ship has position (x,y) and velocity (vx,vy).
- Movement costs depend on thrust and inertia (momentum matters).
- Great for continuous-control RL.

**Option B — Discrete navigation graph (recommended for fast training)**
- Sector is a graph of nodes: asteroid clusters, station, debris fields, safe corridors.
- Actions move between nodes with travel time and fuel cost.
- Great for stable, scalable training with millions of steps.

> Below assumes **graph-based** by default; you can extend to continuous later.

### Procedural generation per episode
Each episode generates:
- 1 station node (home base)
- 6–20 clusters (each contains 5–50 asteroids)
- hazard regions (micro-meteoroid belts, radiation pockets)
- pirate activity fields (latent “threat heatmap”)
- a market scenario (base demand curves, cycle phase, volatility)

This prevents memorization and forces generalization.

---

## 4) Core resources & state variables

### Ship state (examples; tuneable)
- **Fuel** (0–1000): consumed by travel and certain actions
- **Hull** (0–100): damage from hazards, fractures, piracy
- **Heat** (0–100): generated by mining; dissipates slowly; overheating causes damage and efficiency loss
- **Cargo capacity** (0–200 units): ore + junk occupies space
- **Tool condition** (0–100): drill/laser wear reduces yield and increases fracture risk
- **Credits** (unbounded): your score currency
- **Time remaining** (episode budget): forces efficiency
- **Alert level** (0–100): higher means more pirate attention (increases with noisy actions, time in hot zones, carrying high-value cargo)

### Asteroid state (mostly hidden)
Each asteroid has hidden properties:
- **True composition vector**: e.g., Iron, Nickel, Water Ice, Platinum-group, Rare Isotopes, “Volatiles”
- **Richness**: expected yield multiplier (heavy-tailed distribution)
- **Structural stability**: affects fracture risk while mining
- **Surface noise profile**: affects scan reliability
- **Depletion curve**: yield decreases as it’s mined

### Market state (dynamic)
For each commodity:
- **Price(t)** is driven by:
  - base demand cycle (periodic / seasonal)
  - station inventory (supply)
  - your recent sales volume (price impact / slippage)
  - random shocks (rare)

---

## 5) Fundamental game loop (per tick / step)

**Step loop (1 decision per tick, or per “turn”)**
1. Observe: ship status + local node info + sensor readings + current prices.
2. Choose one action (from a discrete action list).
3. Environment updates:
   - travel progress, fuel/heat/tool wear
   - scan results (noisy)
   - mining yield (stochastic)
   - random events (hazards, pirates)
   - market evolves
4. Receive reward.
5. Continue until terminal condition.

**Episode ends when**
- Time budget exhausted  
- Ship destroyed (Hull ≤ 0)  
- Stranded (Fuel = 0 away from station)  
- Optional: player “cash-out” action (end early with current credits)

---

## 6) Elements of strategic depth (what makes it hard)

### A) Information is valuable and costly
- Scanning consumes time/fuel and raises alert level slightly.
- Bad scans mislead you into mining worthless rock.
- Optimal policies learn when to do cheap scans vs deep scans.

### B) Route planning with multi-constraint loadouts
- Cargo fills up; high-value ore may be heavy/bulky.
- Carrying valuable cargo increases pirate risk.
- Heat and tool wear constrain how long you can mine before returning.

### C) Risk management is a real tradeoff
- “Hot zones” have better ore but higher hazard and pirate risk.
- Micro-damage accumulates; a “nearly optimal” path may still fail more often.
- Best policy often maximizes **risk-adjusted** profit, not raw expected profit.

### D) Dynamic market with price impact
- If you dump 100 units of Platinum at once, the station price drops.
- Holding inventory risks piracy and consumes cargo, but may catch a price spike.
- Strong play requires learning demand cycles and managing sell size/timing.

### E) Tool wear and catastrophic failure
- Mining aggressively increases wear and fracture probability.
- A fracture can destroy the asteroid, damage hull, and spray debris (local hazard).
- Optimal mining “style” depends on asteroid stability and your tool condition.

### F) Non-stationary environment across episodes
- Different market regimes and belt distributions require robust, adaptive policies.

---

## 7) Actions (complete list with direct measurable impacts)

All actions are discrete and have explicit effects on ship state, environment state, and reward.

### Navigation & positioning
1. **Travel to Node i (neighbor)**  
   - Cost: Fuel −(base_cost * distance * mass_factor)  
   - Time: +travel_time  
   - Risk: exposure to hazards on route; pirate encounter chance based on threat field  
   - Benefit: access to new clusters/station

2. **Hold Position / Drift**  
   - Cost: small time cost  
   - Benefit: allows heat dissipation and reduces alert growth (safer than mining/scanning)

3. **Emergency Burn (short boost)** *(cooldown action)*  
   - Cost: high fuel  
   - Benefit: reduce pirate encounter probability next few ticks / escape hazard region  
   - Side effect: increases alert (loud maneuver)

### Sensing & information
4. **Wide Scan (cluster-level)**  
   - Cost: low fuel + time; slight alert increase  
   - Output: noisy “ore likelihood map” for a cluster (probabilities, not truth)

5. **Focused Scan (asteroid-level)**  
   - Cost: moderate fuel + time; alert increase  
   - Output: better estimate of composition + stability confidence interval

6. **Deep Spectral Scan (high accuracy, slow)**  
   - Cost: high time + fuel; noticeable alert increase  
   - Output: near-true composition estimate + stability estimate  
   - Strategic role: “commitment scan” before long mining session

7. **Passive Threat Listen**  
   - Cost: time only  
   - Output: estimate pirate activity / threat in neighboring nodes (noisy)

### Mining & extraction
8. **Start Mining (on selected asteroid)** *(sets target for subsequent mining ticks)*  
   - Precondition: at asteroid node and asteroid not depleted  
   - Cost: minimal, initiates mining mode

9. **Mine Tick — Conservative**  
   - Cost: low heat gain, low wear, low fracture risk  
   - Yield: lower expected ore per tick  
   - Good when: tool is worn, asteroid stability uncertain, carrying valuable cargo

10. **Mine Tick — Standard**  
   - Balanced heat/wear/risk vs yield

11. **Mine Tick — Aggressive**  
   - Cost: high heat gain, high wear, higher fracture risk  
   - Yield: high expected ore per tick  
   - Non-linear penalty: once Heat > threshold, efficiency drops and damage risk rises

12. **Stabilize Asteroid (reinforce / anchor)**  
   - Cost: time + small material (consumes “stabilizer charges”)  
   - Effect: reduces fracture probability for that asteroid for N ticks  
   - Strategic: enables aggressive mining safely on good finds

13. **Refine Onboard (convert raw → refined)**  
   - Cost: time + heat + small fuel  
   - Benefit: refined ore takes less cargo space and sells for more  
   - Tradeoff: increases heat/alert and delays return

### Thermal, maintenance, and safety
14. **Active Cooldown (radiator burst)**  
   - Cost: time + small fuel  
   - Effect: Heat −large amount, but increases alert slightly (visible signature)

15. **Tool Maintenance (field repair)**  
   - Cost: time; consumes repair kit  
   - Effect: Tool condition +X  
   - Tradeoff: opportunity cost, but reduces future fracture and increases yield

16. **Hull Patch (field repair)**  
   - Cost: time; consumes repair kit  
   - Effect: Hull +X  
   - Tradeoff: patching early prevents death spirals

17. **Jettison Cargo (drop selected commodity)**  
   - Benefit: reduce mass factor (fuel costs), reduce pirate attractiveness  
   - Cost: lost future credits (immediate negative)  
   - Strategic: survival / escape play

### Station interactions (only at station node)
18. **Dock**  
   - Cost: time  
   - Benefit: unlocks sell/buy/repair; reduces pirate risk to near zero

19. **Sell Commodity j (choose quantity bucket)**  
   - Buckets: {25%, 50%, 100% of held} or fixed units  
   - Reward: Credits + (price * qty)  
   - Side effect: station inventory increases → future price decreases (slippage)

20. **Buy Fuel**  
   - Cost: Credits −(fuel_price * amount)  
   - Effect: Fuel +amount  
   - Strategic: sometimes fuel is expensive; consider risk of one more run vs refuel now

21. **Buy Repair Kit / Stabilizer / Decoy**  
   - Cost: Credits  
   - Effect: increases action capacity for repairs/stabilization/evasion

22. **Full Repair & Tool Overhaul**  
   - Cost: Credits + time  
   - Benefit: Hull to max; Tool condition to max  
   - Strategic: expensive but enables high-risk/high-yield tours

23. **Take Contract (optional system)**  
   - A contract specifies: deliver X units of commodity by T time for bonus  
   - Strategy: introduces planning constraints and risk

24. **Cash Out / End Episode Early**  
   - Ends episode; preserves profit; avoids late-game risk  
   - Strategic: risk-aware stopping policy

---

## 8) Measures of success & performance metrics

### Primary objective metrics (what you optimize)
- **Total credits earned** (end of episode)
- **Net profit** = credits earned − (fuel + repairs + consumables + docking fees)
- **Profit per tick** (efficiency)
- **Survival rate** across episodes

### Risk & efficiency metrics (monitor learning progress)
- **Stranding rate** (Fuel=0 away from station)
- **Overheat incidents** (# ticks Heat > threshold)
- **Hull damage per 1000 ticks**
- **Tool wear cost** (average tool condition / overhaul frequency)
- **Scan ROI**: credits gained per scan action
- **Mining efficiency**: ore value per mining tick
- **Cargo utilization**: average % cargo filled when returning to station
- **Route efficiency**: profit per fuel unit
- **Pirate encounter rate** + **loss severity**
- **Market impact cost**: estimated credits lost to slippage from large sells
- **Contract completion rate** (if contracts enabled)

### Leaderboard-style composite scores (optional)
- **Risk-adjusted profit**:  
  - e.g., `RAR = mean_profit - λ * std_profit - μ * death_rate_penalty`
- **Consistency score**: profit percentile stability across seeds

---

## 9) Reward function designs (detailed)

You’ll likely want **two reward modes**:
1) **Training reward (shaped)** for fast learning  
2) **Evaluation reward (sparse / closer to “true objective”)** to prevent reward hacking

### 9.1 Shaped reward (recommended for training)

Let each tick produce:

**A) Profit and value creation**
- `r_sell = + Δcredits_from_sales` (only when selling)
- `r_extract = + α * (estimated_value_of_ore_extracted_this_tick)`  
  - small α so selling still matters most

**B) Operating costs**
- `r_fuel = - β * fuel_used_this_tick`
- `r_time = - γ` (small constant per tick to encourage efficiency)
- `r_wear = - δ * (tool_condition_drop_this_tick)`
- `r_heat = - ε * max(0, Heat - HeatSafeThreshold)^2` (nonlinear penalty)
- `r_damage = - ζ * hull_damage_this_tick`

**C) Risk and catastrophes**
- `r_pirate = - κ * value_lost_to_pirates`
- `r_stranded_terminal = - S` if stranded
- `r_destroyed_terminal = - D` if destroyed

**D) Optional: information discipline**
- `r_scan = - small_cost` for scanning (prevents scan-spam)
- (Optional) `+ info_gain_bonus` based on reduced uncertainty *if* you explicitly model belief states

**Terminal bonus**
- `r_terminal = + B * (net_profit)` at episode end  
  - encourages end-to-end alignment

**Typical coefficient intent**
- Selling dominates learning signal  
- Heat/damage penalties prevent reckless “farm until death”  
- Time penalty prevents “infinite drift”  
- Fuel/wear makes route + mining mode choices meaningful

### 9.2 Sparse reward (recommended for evaluation)
- Reward only when docking and selling:  
  - `r = + net_profit_from_sale_event`
- Terminal:
  - `-D` destroyed  
  - `-S` stranded  
- Optional small per-tick penalty `-γ` to discourage stalling.

This tests whether the agent truly learned strategy vs exploiting shaping.

### 9.3 Multi-objective reward (advanced RL)
Represent reward as a vector:
- `[profit, -risk, -cost, -time]`
Then evaluate policies on Pareto frontier or with different preference weights.

---

## 10) Key balancing knobs (to keep it deep and non-linear)

### Procedural richness distribution
- Use heavy-tail: most asteroids mediocre; a few jackpots.
- This makes exploration strategy and risk worth it.

### Scan noise model
- Make shallow scans biased and sometimes confidently wrong.
- Deep scans are expensive but more reliable.
- This creates a real information-gathering tradeoff.

### Market dynamics + price impact
- Price cycles with noise (learnable but not trivial).
- Large sells produce slippage (agent must learn to stagger).

### Pirate attention mechanics
- Threat depends on:
  - region latent heat
  - time spent away from station
  - cargo value
  - “loud” actions (aggressive mining, active cooldown bursts, emergency burns)
- Encourage strategies like “quiet runs”, decoy use, short tours vs long tours.

### Catastrophic fracture risk
- Risk increases with aggressive mining, worn tools, unstable asteroids, high heat.
- Strong agents learn to **stabilize** selectively and maintain tools.

---

## 11) What the agent can “figure out” (weeks/months for a human)

A human trying to truly optimize would need to learn:
- which scan strategy best predicts jackpots under noise
- how to plan tours (multi-cluster routes) under fuel/heat/wear constraints
- how to sell to avoid price collapse while minimizing piracy exposure
- how to modulate alert level and use decoys/escape burns optimally
- when to refine onboard vs station sale
- risk-adjusted optimization: policies that are slightly lower EV but far higher survival win long-run

This is exactly the kind of thing RL can improve over **millions of steps**.

---

## 12) Recommended episode structure (for scalable training)

- Decision frequency: 1 action per tick
- Episode length: 2,000–20,000 ticks (curriculum: start short, scale up)
- Start state randomization:
  - initial fuel, tool condition, small credit variance
  - market phase random
  - belt seed random

**Curriculum suggestion**
1) No pirates, simple prices  
2) Add scan noise + fractures  
3) Add price impact  
4) Add pirates + alert mechanics  
5) Full system (contracts, rare shocks)

---

If you want, I can also give you a **formal RL spec** (Gym-style):
- observation vector (exact fields)
- action indexing (0..N-1)
- transition pseudocode
- reward function code-ready definition
- a set of “baseline bots” (greedy miner, cautious scanner, market timer) so you can benchmark learning.
